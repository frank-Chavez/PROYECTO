<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title }}</title>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    {% block head %}{% endblock %}
  </head>

  <body class="dashboar" style="display: flex; min-height: 100vh">
    <!-- Sidebar -->
    <aside class="sidebar" style="flex: 0 0 260px">
      <div class="logo">
        <div class="logo-text">
          <h2>Sistema Empresa</h2>
        </div>
      </div>

      <nav>
        <a
          href="{{ url_for('dashboar') }}"
          class="{% if request.endpoint == 'dashboar' %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'dashboar' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/home.svg') }}"
            alt=""
          />
          Dashboard
        </a>
        <a
          href="{{ url_for('familiares.listar') }}"
          class="{% if request.endpoint.startswith('familiares') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'familiares' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/familiares.svg') }}"
            alt=""
          />
          Familiares
        </a>
        <a
          href="{{ url_for('fallecidos.listar') }}"
          class="{% if request.endpoint.startswith('fallecidos') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'fallecidos' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/fallecidos.svg') }}"
            alt=""
          />
          Fallecidos
        </a>
        <a
          href="{{ url_for('proveedor.listar') }}"
          class="{% if request.endpoint.startswith('proveedor') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'proveedor' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/proveedor.svg') }}"
            alt=""
          />
          Proveedores
        </a>
        <a
          href="{{ url_for('planes.listar') }}"
          class="{% if request.endpoint.startswith('planes') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'planes' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/planes.svg') }}"
            alt=""
          />
          Planes
        </a>
        <a
          href="{{ url_for('servicios.listar') }}"
          class="{% if request.endpoint.startswith('servicios') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'servicios' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/servicios.svg') }}"
            alt=""
          />
          Servicios
        </a>
        <a
          href="{{ url_for('cotizacion.listar') }}"
          class="{% if request.endpoint.startswith('cotizacion') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'cotizacion' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/cotizaciones.svg') }}"
            alt=""
          />
          Cotizaciones
        </a>
        {% if session.get('permisos', {}).get('administrar_sistema') == 1 %}

        <a
          href="{{ url_for('configuracion.index') }}"
          class="{% if request.endpoint.startswith('configuracion') %}active{% endif %}"
        >
          <img
            class="{% if request.endpoint == 'configuracion' %}active{% endif %}"
            src="{{ url_for('static', filename='icons/seting.svg') }}"
            alt=""
          />
          configuracion
        </a>
        {% endif %}

        <a href="{{ url_for('logout') }}" class="logout-btn">
          <img
            src="{{ url_for('static', filename='icons/exit.svg') }}"
            alt=""
          />
          salir
        </a>
      </nav>
    </aside>

    <!-- Main -->
    <main>
      {% block content %}

      <div class="dashboard-header">
        <div>
          <h1 class="dashboard-title">Dashboard</h1>
          <p class="dashboard-subtitle">
            Bienvenido al sistema de gestión crematorio
          </p>
        </div>
      </div>

      <!-- Tarjetas resumen (totales REALES) -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-body">
            <h5 class="stat-title">Familiares Registrados</h5>
            <div class="stat-number">{{ familiares_count }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-body">
            <h5 class="stat-title">Servicios Activos</h5>
            <div class="stat-number">{{ servicios_count }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-body">
            <h5 class="stat-title">Cotizaciones del Mes</h5>
            <div class="stat-number">{{ cotizaciones_count }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-body">
            <h5 class="stat-title">Proveedores Activos</h5>
            <div class="stat-number">{{ proveedores_count }}</div>
          </div>
        </div>
      </div>

      <!-- Actividad Reciente + Acciones Rápidas -->
      <div class="content-row">
        <!-- Actividad Reciente -->
        <div class="activity-section">
          <h4 class="section-title">Actividad Reciente</h4>
          <div class="activity-list">
            <!-- Familiar más reciente -->
            <div class="activity-item">
              <img
                src="{{ url_for('static', filename='icons/familiares.svg') }}"
                alt=""
                class="activity-icon"
              />
              <div class="activity-content">
                <span class="activity-label">Nuevo familiar:</span>
                <span class="activity-text">
                  {% if reciente_familiar %} {{ reciente_familiar[0] }} ({{
                  reciente_familiar[1] }}) {% else %} (sin registros) {% endif
                  %}
                </span>
              </div>
            </div>

            <!-- Cotización más reciente -->
            <div class="activity-item">
              <img
                src="{{ url_for('static', filename='icons/cotizaciones.svg') }}"
                alt=""
                class="activity-icon"
              />
              <div class="activity-content">
                <span class="activity-label">Cotización:</span>
                <span class="activity-text">
                  {% if reciente_cotizacion %} {{ reciente_cotizacion[0] }} ({{
                  reciente_cotizacion[1] }}) {% else %} (sin registros) {% endif
                  %}
                </span>
              </div>
            </div>

            <!-- Servicio más reciente -->
            <div class="activity-item">
              <img
                src="{{ url_for('static', filename='icons/servicios.svg') }}"
                alt=""
                class="activity-icon"
              />
              <div class="activity-content">
                <span class="activity-label">Servicio:</span>
                <span class="activity-text">
                  {% if reciente_servicio %} {{ reciente_servicio[0] }} {% if
                  reciente_servicio[1] %}({{ reciente_servicio[1] }}){% endif %}
                  {% else %} (sin registros) {% endif %}
                </span>
              </div>
            </div>

            <!-- Proveedor más reciente -->
            <div class="activity-item">
              <img
                src="{{ url_for('static', filename='icons/proveedor.svg') }}"
                alt=""
                class="activity-icon"
              />
              <div class="activity-content">
                <span class="activity-label">Proveedor:</span>
                <span class="activity-text">
                  {% if reciente_proveedor %} {{ reciente_proveedor[0] }} ({{
                  reciente_proveedor[1] }}) {% else %} (sin registros) {% endif
                  %}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Acciones Rápidas -->
        <div class="actions-section">
          <h4 class="section-title">Acciones Rápidas</h4>
          <div class="actions-card">
            <a
              href="{{ url_for('familiares.agregar') }}"
              class="action-btn action-btn-primary"
            >
              <img
                src="{{ url_for('static', filename='icons/familiares.svg') }}"
                alt=""
              />
              Agregar Familiar
            </a>
            <a
              href="{{ url_for('cotizacion.agregar') }}"
              class="action-btn action-btn-success"
            >
              <img
                src="{{ url_for('static', filename='icons/cotizaciones.svg') }}"
                alt=""
              />
              Agregar Cotización
            </a>
            <a
              href="{{ url_for('planes.agregar') }}"
              class="action-btn action-btn-warning"
            >
              <img
                src="{{ url_for('static', filename='icons/planes.svg') }}"
                alt=""
              />
              Agregar Plan
            </a>
          </div>
        </div>
      </div>

      {% endblock %}
    </main>

    <!-- Bootstrap JS (opcional si no usas componentes JS) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      function sinPermiso() {
        Swal.fire({
          icon: 'error',
          title: 'Acceso denegado',
          text: 'No tienes permisos para realizar esta acción.',
          confirmButtonText: 'Entendido',
          confirmButtonColor: '#3085d6',
        });
      }
    </script>
  </body>
</html>
